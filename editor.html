<!DOCTYPE html>
<html lang="hr">
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="editor.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <div class="zaglavlje">
      <h1>THE LAST STARSHIP (Draft 2)</h1>

      <input
        type="text"
        class="naslov"
        placeholder="Unesite naslov novog scenarija"
      />
      <button class="dugme" onclick="kreirajScenarij()">
        + Kreiraj novi scenarij
      </button>
      <input type="number" class="broj" placeholder="ID scenarija" />
      <button class="dugme1" onclick="otvoriScenarij()">Otvori scenarij</button>
        <div class="lockLine">
            <input type="number" class="idScenarija" placeholder="ID scenarija" />
            <input type="number" class="idUser" placeholder="ID korisnika" />
            <input
            type="number"
            class="redniBroj"
            placeholder="Redni broj linije"
            />
            <button class="dugme2" onclick="lockLine()">Zaključaj liniju</button>
      <div class="updateLine">
        <input
          type="text"
          class="tekstLinije"
          placeholder="Unesite novi tekst linije"
        />
        <input type="number" class="idScenarija" placeholder="ID scenarija" />
        <input type="number" class="idUser" placeholder="ID korisnika" />
        <input
          type="number"
          class="redniBroj"
          placeholder="Redni broj linije"
        />
        <button class="dugme2" onclick="updateLine()">Ažuriraj liniju</button>
      </div>
    </div>

    <div class="sidebar">
      <h3><b>Scene (12)</b></h3>
    </div>

    <div class="sadrzaj">
      <h3 class="naslov"></h3>
      <br />
      <p></p>
    </div>

    <script src="PoziviAjax.js"></script>
    <script>
      function kreirajScenarij() {
        const titleInput = document.querySelector("input.naslov");
        const title = titleInput ? titleInput.value : "";

        PoziviAjax.postScenario(title, function (status, response) {
          if (status === 201 && response && response.title) {
          } else {
            alert("Došlo je do pogreške prilikom kreiranja scenarija.");
          }
        });
      }
      function otvoriScenarij() {
        const idInput = document.querySelector("input.broj");
        const id = idInput ? idInput.value : "";
        let text = "";

        PoziviAjax.getScenario(id, function (status, response) {
          if (status === 200 && response) {
            const naslovElement = document.querySelector(".sadrzaj .naslov");
            const paragrafElement = document.querySelector(".sadrzaj p");

            if (naslovElement) {
              naslovElement.textContent = response.title || "Nema naslova";
            }
            if (paragrafElement) {
              for (let i = 0; i < response.content.length; i++) {
                text += response.content[i].text + "\n\n";
              }
              paragrafElement.textContent = text;
            }
          } else {
            alert("Došlo je do pogreške prilikom otvaranja scenarija.");
          }
        });
      }
      function lockLine() {
        let lineId = document.querySelector("div.lockLine input.redniBroj").value;
        let scenarioId = document.querySelector("div.lockLine input.idScenarija").value;
        let userId = document.querySelector("div.lockLine input.idUser").value;
        PoziviAjax.lockLine(
          scenarioId,
          lineId,
          userId,
          function (status, response) {
            if (status === 200 && response) {
              alert("Linija je uspješno zaključana.");
            } else {
              alert("Došlo je do pogreške prilikom zaključavanja linije.");
            }
          }
        );
      }

      function updateLine() {
        let lineId = document.querySelector("div.updateLine input.redniBroj").value;
        let scenarioId = document.querySelector("div.updateLine input.idScenarija").value;
        let userId = document.querySelector("div.updateLine input.idUser").value;
        let newText = document.querySelector("div.updateLine input.tekstLinije").value;
        PoziviAjax.updateLine(
          scenarioId,
          lineId,
          userId,
          newText,
          function (status, response) {
            if (status === 200 && response) {
              alert("Linija je uspješno ažurirana.");
              document.querySelector("input.broj").value = scenarioId;
              otvoriScenarij();
            } else {
              alert("Linija nije ažurirana. Došlo je do pogreške.");
            }
          }
        );
      }
    </script>
  </body>
</html>
